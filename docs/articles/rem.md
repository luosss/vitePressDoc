---
title: rem和vw单位与移动端适配最佳实践
pages: true
---

## rem和vw单位与移动端适配最佳实践

CSS3单位——rem

其中，“r”是`root`的意思，在`HTML`网页中，`root`指的就是`<html>`元素，正如`CSS`伪类`:root`的目标元素和`html`属性选择器一样。

例如，已知
```CSS
html {
  font-size: 16px;
}
```
则`0.5rem`就是`8px`，`1rem`就是`16px`，`2rem`就是`32px`。

如果根字号大小是20px，CSS代码如下：
```CSS
html {
  font-size: 20px;
}
```
则`0.5rem`就是`10px`，`1rem`就是`20px`，`2rem`就是`40px`。

所以，要想使整个网页保持弹性其实很简单，让元素的宽高和文字的尺寸大小都使用`rem`单位，然后在不同宽度的设备下设置准确的根字号大小就可以了。

于是，衍生出下面两种做法。

1. 设定临界点字号。代码如下：
```CSS
html {
  font-size: 16px;
}

@media (min-width: 414px) {
  html {
    font-size: 18px;
  }
}

@media (min-width: 600px) {
  html {
    font-size: 20px;
  }
}
```
不足点在于对于非临界点尺寸的设备很不友好，例如Pixel 2手机的宽度是`411px`，不属于任何临界点，代码中使用的根字号是`16px`，显然偏小，最终的体验就不好。

2. 头部嵌入一段JS代码，根据屏幕尺寸设置对应的根字号大小。下面是曾经在业界用过一段时间的计算公式：
```JS
document.documentElement.style.width = document.documentElement.clientWidth / 7.5 + 'px';
```

这种写法的有点在于任何宽度的手机都有对应的根字号设置，但是根字号会线性放大，如果是使用iPad等设备访问，则会看到超级夸张的字号和布局尺寸；

最后，基准字号是`50px`，与默认的`16px`相去甚远，日后想要推翻之前的适配策略（例如改成`16px`的基准字号）则改动巨大，举步维艰。

于是就有了另一个CSS新特性来优化上面的两种做法，那就是视区相对单位vw。

### 了解视区相对单位

视区相对单位指的是相对于浏览器视区尺寸（viewport）的单位，具体包括下面4个。

- `vw`——视区宽度百分值
- `vh`——视区高度百分值
- `vmin`——`vw`或`vh`，取小的那个值
- `vmax`——`vw`或`vh`，取大的那个值

我们以最常用的`vw`单位为例，`100vw`表示1个视区宽度，在手机的浏览器中，视区宽度就等于手机的像素宽度。

例如，在iPhone X中，`100vw`就等同于iPhone X设备的宽度，由于iPhone X设备宽度是`375px`，`10vw`表示视区宽度的`1/10`，因此在iPhone X中`10vw`对应的宽度是`37.5px`

下面说个`vh`单位的经典应用，那就是当内容高度不足一屏时，让底部栏贴在浏览器窗口的底部；当内容高度超过一屏时，让底部栏贴在页面最下方。

假设HTML代码结构如下：
```HTML
<div class="container">
  <content></content>
  <footer></footer>
</div>
```
使用如下几行CSS代码即可实现想要的布局效果：
```CSS
.container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
footer {
  margin-top: auto;
}
```
其中，最精彩的就是min-height:100vh，也就是让容器元素的高度至少保持一个视区的高度。

[dome示例](https://demo.cssworld.cn/new/7/3-1.php) <br/>

### calc()函数下的最佳实践

有了`vw`单位，再配合`calc()`函数进行计算，无须使用任何`JS`代码，我们就可以实现基于设备宽度的移动端布局适配方案

例如，希望`375px`～`414px`的宽度区间的根字号大小是`16px`～`18px`，就可以这么设置：

```CSS
html{
  font-size: 16px;
}

@media screen and (min-width: 375px) {
 html {
    /* 375px宽度使用16px基准尺寸，414px宽度时根字号大小正好是18px */
    font-size: calc(16px + 2 * (100vw - 375px) / 39);
  }
}
/* 等同于 */
@media screen and (min-width: 414px) {
  html {
    font-size: 18px;
  }
}
```

这样，无论手机的宽度是多少，都可以有一个合适的根字号大小，此时只需要把视觉稿对应的px尺寸使用rem表示就可以了。

#### 最佳实践范例代码

下面这段CSS代码是基于`rem`和`vw`单位并配合`calc()`函数的移动端适配代码

例如screen and可以删除，1000px之后的尺寸可以使用固定值

```CSS
html {
  font-size: 16px;
}
@media screen and (min-width: 375px) {
  html {
    /* 375px作为16px基准，414px宽度时正好对应18px的根字号大小 */
    font-size: calc(16px + 2 * (100vw - 375px) / 39);
  }
}
@media screen and (min-width: 414px) {
  html {
    /* 屏幕宽度从414px到1000px，根字号大小累积增加4px（18px-22px）*/
    font-size: calc(18px + 4 * (100vw - 414px) / 586);
  }
}
@media screen and (min-width: 1000px) {
  html {
    /* 屏幕宽度从1000px往后每增加100px，根字号大小就增加0.5px */
    font-size: calc(22px + 5 * (100vw - 1000px) / 1000);
  }
}
```

这段代码的优点是兼容性非常强，尺寸有弹性，纯CSS驱动，同时在宽屏下布局尺寸不至于过大（`1000px`宽度屏幕下的字号是`22px`，使用之前的`JS`计算方法的话，`1000px`宽度屏幕下的字号大约是`43px`，尺寸太大）。

当然，随着越来越多的浏览器支持`clamp()`函数，我们也可以使用下面这种更加精简的语法：
```CSS
html {
 font-size: 16px;
  font-size: clamp(16px, calc(16px + 2 * (100vw - 375px) / 39), 22px);
}
```
根字号的变化范围虽然不及`@media`语法实现得精细，但贵在代码比较精简。

题外话：

`clamp()`函数的作用是把一个值限制在一个上限和下限之间，当这个值超过最小值和最大值的范围时，在最小值和最大值之间选择一个值使用。它接收三个参数：最小值、首选值、最大值。

```CSS
clamp(MIN, VAL, MAX) 其实就是表示 max(MIN, min(VAL, MAX))
```

#### rem单位不是万能的

上面的rem单位布局方法并不是万能的，首先渲染尺寸并不总是整数

例如，`1.25rem`在`375px`宽度屏幕下的计算值是`20px`，但是在`414px`宽度屏幕下的计算值却是`22.5px`。

非整数尺寸偶尔会带来一些渲染的问题

例如，当SVG图标尺寸不是整数的时候，边缘可能会出现奇怪的间隙；又如，需要精确知道若干个列表的高度之和的时候，如果列表的高度不是整数，则最终的高度值和实际的渲染高度值会有误差。

在这些场景下，可以将对应元素的`rem`单位改成`px`单位进行表示。

### 适合新手的纯vw单位的布局

使用`vw`单位，既可以采用固定布局，又能实现不同尺寸的适配。

于是，一种纯`vw`单位的布局方式很快就在CSS开发新人中广为流传。

在这种纯vw单位的布局方式下，布局尺寸和图文大小既不使用`px`单位，也不使用`rem`单位，而是统一使用`vw`单位。

例如，视觉稿上图片的尺寸是`120px×80px`，使用`vw`单位表示就是

```CSS
img {
  width: 32vw;
  height: 21.333vw;
}
```

又如，3px的间隙使用vw单位表示就是：
```CSS
.container {
  gap: calc(3 * 100vw / 375);
  /* 也可以直接设置成： */
  /* gap： .8vw; */
}
```

切单位皆是vw。于是，开发的时候只需要使用`vw`单位按照1∶1的尺寸将视觉稿复刻下来，就可以做到无论是什么宽度的设备，都会等比例缩放，不用担心因为设备宽度不一样而出现错位或无法对齐等布局问题。

但是，不建议在长期维护的大型项目中使用纯vw布局方式，因为这种布局方式一旦确定，后期更换布局的成本会非常高，这种布局方式比较适合用在运营活动页面中。